"use strict";app.controller("WorkRecruitCtrl",["$scope","$controller","$location","$window","$log","workModel","workRecruitModel","searchModel","itemService",function($scope,$controller,$location,$window,$log,workModel,workRecruitModel,searchModel,itemService){$controller("AbstractCtrl",{$scope:$scope}),$log.debug("WorkRecruitCtrl Start"),$scope.errors=null,$scope.displayMessages="",$scope.workModel=workRecruitModel.workRecruit.get(),$scope.$on("changedWorkRecruit",function(){$scope.workModel=workRecruitModel.workRecruit.get()}),$scope.initCommon(),$scope.updateWork=function(model,isPreview){$scope.showProgressModal(),$scope.errors=null,$scope.displayMessages="",model.limit_date=$("#workModel_limit_date_recruit_modal").val(),model.noki=$("#workModel_noki_recruit_modal").val(),model.preview_flg=isPreview?1:0,itemService.insertItem(model).success(function(data){if($scope.hideProgressModal(),1==model.preview_flg)return void $window.open($location.$$protocol+"://"+$location.$$host+":"+$location.$$port+"/#/work/detail/"+data.id);$("#modal-recruit").modal("hide"),$("#alert-message").html("\u4ed5\u4e8b\u4f9d\u983c\u304c\u767b\u9332\u3055\u308c\u307e\u3057\u305f\u3002\u767b\u9332\u3057\u305f\u4ed5\u4e8b\u4f9d\u983c\u306fMY\u30da\u30fc\u30b8\u3088\u308a\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002"),$("#modal-alert").modal("show"),workRecruitModel.workRecruit.init(),$scope.workModel=workRecruitModel.workRecruit.get(),workModel.work.set(data);var search=searchModel.search.get();searchModel.search.set(search)}).error(function(data){$scope.hideProgressModal();var messages=[];$scope.errors=data,$scope.setErrorMessage(data.work_kbn,"\u4ed5\u4e8b\u30ab\u30c6\u30b4\u30ea",messages),$scope.setErrorMessage(data.title,"\u4f9d\u983c\u30bf\u30a4\u30c8\u30eb",messages),$scope.setErrorMessage(data.payment_kbn,"\u652f\u6255\u65b9\u5f0f",messages),$scope.setErrorMessage(data.hour_price_kbn,"\u6642\u7d66",messages),$scope.setErrorMessage(data.week_hour_kbn,"\u4ed5\u4e8b\u91cf",messages),$scope.setErrorMessage(data.week_hour_period_kbn,"\u4e88\u5b9a\u671f\u9593",messages),$scope.setErrorMessage(data.price,"\u76ee\u5b89\u4e88\u7b97",messages),$scope.setErrorMessage(data.noki,"\u5e0c\u671b\u7d0d\u671f",messages),$scope.setErrorMessage(data.limit_date,"\u52df\u96c6\u306e\u7de0\u3081\u5207\u308a",messages),$scope.setErrorMessage(data.content,"\u4f9d\u983c\u306e\u76ee\u7684\u30fb\u80cc\u666f",messages),$scope.setErrorMessage(data.error_message,"",messages),$scope.displayMessages=$scope.getMessage(messages),$("#modal-recruit").animate({scrollTop:0},"slow"),setTimeout(function(){$scope.showLoginDialogWhenNotLogin()},500),setTimeout(function(){$("#modal-recruit").modal("handleUpdate")},1e3)})},$scope.changeWorkKbn=function(){$scope.workModel.work_kbn_nm=$scope.getWorkKbnName($scope.workModel.work_kbn)},$scope.isProjectPayment=function(){return $scope.workModel.payment_kbn&&"122"==$scope.workModel.payment_kbn?!0:!1}}]);