"use strict";app.controller("IndexCtrl",["$scope","$rootScope","$controller","$timeout","$interval","$location","$log","worksIndexModel","searchModel","itemService","userService",function($scope,$rootScope,$controller,$timeout,$interval,$location,$log,worksIndexModel,searchModel,itemService,userService){$controller("AbstractCtrl",{$scope:$scope}),$log.debug("IndexCtrl Start"),$scope.worksIndex=worksIndexModel.worksIndex.get(),$scope.$on("changedSearch",function(){$scope.search=searchModel.search.get(),$scope.getWorkList($scope.search)}),$scope.getSearchlocalStorage=function(){var storage=localStorage;if(void 0==storage||null==storage)return null;var searchJsonString=storage.getItem("search");return void 0==searchJsonString||null==searchJsonString||""==searchJsonString?null:JSON.parse(searchJsonString)},$scope.setSearchlocalStorage=function(search){var storage=localStorage;if(void 0!=storage&&null!=storage){var searchJsonString=JSON.stringify(search);storage.setItem("search",searchJsonString)}},$scope.getWorkList=function(search,isButton){itemService.getItems(search).success(function(data){$scope.worksIndex=data,$scope.setSearchlocalStorage(search),isButton&&$("#modal-work-search").modal("hide")}).error(function(){})},$scope.isLastCol=function(index){return(index+1)%3==0?!0:!1},$scope.getLimitDayString=function(limitDay){return void 0!=limitDay&&limitDay>0?"\u6b8b\u308a "+limitDay+"\u65e5":"\u52df\u96c6\u7d42\u4e86"},$scope.isLimitDayEnd=function(limitDay){return void 0!=limitDay&&limitDay>0?!1:!0},$scope.isDisablePaymentKbn=function(isHour){if(void 0==$scope.search||void 0==$scope.search.payment_kbn)return!1;if(isHour){if("121"==$scope.search.payment_kbn||"123"==$scope.search.payment_kbn)return!1}else if("122"==$scope.search.payment_kbn||"123"==$scope.search.payment_kbn)return!1;return!0},$scope.getContentString=function(value){return void 0==value||""==value?"":value.replace(/\r?\n/g," ")},$scope.changePaymentKbn=function(){void 0!=$scope.search&&void 0!=$scope.search.payment_kbn&&("121"==$scope.search.payment_kbn&&($scope.search.projectPriceStart="",$scope.search.projectPriceEnd=""),"122"==$scope.search.payment_kbn&&($scope.search.hourPriceStart="",$scope.search.hourPriceEnd=""))},$scope.authEmail=function(){if(void 0==$rootScope.is_mail_auth_check||1!=$rootScope.is_mail_auth_check){var param=$scope.getParamEmailToken();if(""==param)return void($rootScope.is_mail_auth_check=1);$scope.errors=null,$scope.displayMessages="",userService.authEmail(param).success(function(){$rootScope.is_mail_auth_check=1,$("#alert-message").html("\u30e1\u30fc\u30eb\u8a8d\u8a3c\u304c\u6210\u529f\u3057\u307e\u3057\u305f\u3002"),$("#modal-alert").modal("show"),$("#modal-alert").on("hidden.bs.modal",function(){$("#modal-alert").unbind(),$("#modal-login").modal("show"),$("#inputLoginEmail").focus()})}).error(function(data){$rootScope.is_mail_auth_check=1;var messages=[];$scope.errors=data,$scope.setErrorMessage(data.error_message,"",messages);var msg=$scope.getMessage(messages);void 0!=msg&&""!=msg&&($("#alert-message").html(msg),$("#modal-alert").modal("show"))})}},$scope.checkAllWorkCategory=function(){$scope.search.work_kbn1=!0,$scope.search.work_kbn2=!0,$scope.search.work_kbn3=!0,$scope.search.work_kbn4=!0,$scope.search.work_kbn11=!0,$scope.search.work_kbn12=!0,$scope.search.work_kbn13=!0,$scope.search.work_kbn14=!0,$scope.search.work_kbn15=!0,$scope.search.work_kbn16=!0,$scope.search.work_kbn21=!0,$scope.search.work_kbn22=!0,$scope.search.work_kbn23=!0,$scope.search.work_kbn24=!0,$scope.search.work_kbn25=!0,$scope.search.work_kbn31=!0,$scope.search.work_kbn32=!0,$scope.search.work_kbn33=!0,$scope.search.work_kbn41=!0,$scope.search.work_kbn42=!0,$scope.search.work_kbn43=!0,$scope.search.work_kbn44=!0,$scope.search.work_kbn51=!0,$scope.search.work_kbn52=!0,$scope.search.work_kbn53=!0,$scope.search.work_kbn61=!0,$scope.search.work_kbn62=!0,$scope.search.work_kbn63=!0,$scope.search.work_kbn64=!0,$scope.search.work_kbn65=!0,$scope.search.work_kbn66=!0,$scope.search.work_kbn67=!0,$scope.search.work_kbn68=!0,$scope.search.work_kbn71=!0,$scope.search.work_kbn72=!0,$scope.search.work_kbn73=!0,$scope.search.work_kbn74=!0,$scope.search.work_kbn75=!0,$scope.search.work_kbn76=!0,"$apply"!=$scope.$root.$$phase&&"$digest"!=$scope.$root.$$phase&&$scope.$apply()},$scope.unCheckAllWorkCategory=function(){$scope.search.work_kbn1=!1,$scope.search.work_kbn2=!1,$scope.search.work_kbn3=!1,$scope.search.work_kbn4=!1,$scope.search.work_kbn11=!1,$scope.search.work_kbn12=!1,$scope.search.work_kbn13=!1,$scope.search.work_kbn14=!1,$scope.search.work_kbn15=!1,$scope.search.work_kbn16=!1,$scope.search.work_kbn21=!1,$scope.search.work_kbn22=!1,$scope.search.work_kbn23=!1,$scope.search.work_kbn24=!1,$scope.search.work_kbn25=!1,$scope.search.work_kbn31=!1,$scope.search.work_kbn32=!1,$scope.search.work_kbn33=!1,$scope.search.work_kbn41=!1,$scope.search.work_kbn42=!1,$scope.search.work_kbn43=!1,$scope.search.work_kbn44=!1,$scope.search.work_kbn51=!1,$scope.search.work_kbn52=!1,$scope.search.work_kbn53=!1,$scope.search.work_kbn61=!1,$scope.search.work_kbn62=!1,$scope.search.work_kbn63=!1,$scope.search.work_kbn64=!1,$scope.search.work_kbn65=!1,$scope.search.work_kbn66=!1,$scope.search.work_kbn67=!1,$scope.search.work_kbn68=!1,$scope.search.work_kbn71=!1,$scope.search.work_kbn72=!1,$scope.search.work_kbn73=!1,$scope.search.work_kbn74=!1,$scope.search.work_kbn75=!1,$scope.search.work_kbn76=!1,"$apply"!=$scope.$root.$$phase&&"$digest"!=$scope.$root.$$phase&&$scope.$apply()};var stop;$("#modal-work-search").unbind(),$("#modal-work-search").on("shown.bs.modal",function(){stop=$interval(function(){$("#modal-work-search").modal("handleUpdate")},200)}),$("#modal-work-search").on("hidden.bs.modal",function(){angular.isDefined(stop)&&$interval.cancel(stop)}),$scope.search=$scope.getSearchlocalStorage(),void 0==$scope.search||null==$scope.search||""==$scope.search?$scope.search=searchModel.search.get():searchModel.search.set($scope.search),$scope.getWorkList($scope.search,!1),$scope.authEmail()}]);